#  Лабораторная работа - Настройка NAT для IPv4.


###  Задание:

+ Часть 1. Создание сети и настройка основных параметров устройства
+ Часть 2. Настройка и проверка NAT для IPv4
+ Часть 3. Настройка и проверка PAT для IPv4
+ Часть 4. Настройка и проверка статического NAT для IPv4.


### Топология:

![](./imgs/tp.png)


### Таблица адресации:


<table>

<tr>
	<td>Устройство</td>
	<td>Interface</td>
	<td>IP-адрес</td>
	<td>Маска подсети</td>
</tr>

<tr>
        <td rowspan="2">R1</td>
        <td>E0/0</td>
	  <td>209.165.200.230</td>
	  <td>255.255.255.248</td>
</tr>

<tr>
        <td>E0/1</td> 
	  <td>192.168.1.1</td>
	  <td>255.255.255.0</td>
</tr>

<tr>
        <td rowspan="2">R2</td> 
	  <td>E0/0</td>
	  <td>209.165.200.225</td>
	  <td>255.255.255.248</td>
</tr>

<tr>
        <td>lo1</td> 
	  <td>209.165.200.1</td>
	  <td>255.255.255.224</td>
</tr>

<tr>
        <td>S1</td> 
	  <td>VLAN 1</td>
	  <td>192.168.1.11</td>
	  <td>255.255.255.0</td>
</tr>

<tr>
        <td>S2</td> 
	  <td>VLAN 1</td>
	  <td>192.168.1.12</td>
	  <td>255.255.255.0</td>
</tr>

<tr>
        <td>PC-A</td>
        <td>NIC</td>
	  <td>192.168.1.2</td>
	  <td>255.255.255.0</td>
</tr>

<tr>
        <td>PC-B</td>
        <td>NIC</td>
	  <td>192.168.1.3</td>
	  <td>255.255.255.0</td>
</tr>

</table>


### Домашнее задание:


Выполним базовую настройку маршрутизаторов, настроим интерфейсы и пропишем маршрут по умолчанию на R2 к R1

![](./imgs/1.png)


Выполним базовую настройку коммутаторов и svi интерфейсов

![](./imgs/2.png)

Отключим неиспользуемые интерфейсы

![](./imgs/3.png)

Создадим аксесс лист 1 и разрешим в нем сетку 192.168.1.
Также создадим нат пулл, который будет срабатывать на аксесс лист выше.
Свяжем акксес лист и пулл, повесим пулл на вход e0/1 и на выход e0/0.

![](./imgs/4.png)


Пропингуем lo1 c PC-B на R2 и проверить nat таблицу на R1

![](./imgs/5.png)

Вопрос: Во что был транслирован внутренний локальный адрес PC-B?

Ответ: 209.165.200.226
 
Вопрос: Какой тип адреса NAT является переведенным адресом?

Ответ: Не очень понял вопрос

Сделаем тоже самое, но с PC-A

![](./imgs/6.png)


Вопрос: Во что был транслирован внутренний локальный адрес PC-B?

Ответ: 209.165.200.227
 
Вопрос: Какой тип адреса NAT является переведенным адресом?

Ответ: Не очень понял вопрос


Включим маршрутизацию, настроим маршрут по умолчанию на SW2 и попробуем пропинговать R2 lo1. Все успешно пингуется, тк у нас отсался 1 адресс, в нас пуле, в запасе

![](./imgs/7.png)

Проверим таблицу соотв. нат пула с адресом устройств 

![](./imgs/8.png)

Обнулим тамблицу нат

![](./imgs/9.png)


Соединим акксес лист с нам пулом, но уже с перегрузкой

![](./imgs/10.png)

Снова пропингуем lo1 R2  и проверим нат таблицу на R1

![](./imgs/11.png)

Вопрос: Во что был транслирован внутренний локальный адрес PC-B?

Ответ: 209.165.200.228
 
Вопрос: Какой тип адреса NAT является переведенным адресом?

Ответ: Не очень понял вопрос

Вопрос: Чем отличаются выходные данные команды show ip nat translations из упражнения NAT?

Ответ: в pat отсутствует жесткая привязка адреса хоста и адреса из нат пула

Также выполним пинг с PC-A, проверим нат таблицу и таблицу соотв.

![](./imgs/12.png)


Пропингуем lo1 сразу с нескольких хостов и проверим нат таблицу на R1

![](./imgs/13.png)

Вопрос: Как маршрутизатор отслеживает, куда идут ответы? 

Ответ: По номеру порта

Очистим нат таблицу 

![](./imgs/14.png)

Удалим соотв. акксес листа с нат пулом и удалим сам нат пулл. И включим pat перегрузку интерфейса.

![](./imgs/15.png)


Пропингуем с обоих хостов и проверим нат таблицу. Видим, что натируется через ip порта маршрутизатора.

![](./imgs/16.png)

Очистим нат таблицу.

![](./imgs/17.png)

Настроим статический нат с адреса 192.168.1.2 на 209.165.200.229

![](./imgs/18.png)

Проверим таблицу нат 

![](./imgs/19.png)
 
 